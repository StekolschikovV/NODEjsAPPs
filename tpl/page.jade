doctype
html
    head
        title!=name
        meta(charset='utf-8')
        link(href="./style.css", rel='stylesheet')
    body
        #loadAll(onclick="loadAll()") Загрузить историю сообещений
        #mes-container
        form(onSubmit="return clicksend()" )
            input(type='text', id='mesText', placeholder='Введи сообщение...')
            input(type='submit', value='send')
        script(src='/socket.io/socket.io.js')
        script.
            let socket = io();
            socket.on('reload', function () { location.reload(); });
            function clicksend() {
                let inp = document.getElementById("mesText").value;
                if(inp != '')
                    socket.emit('new message send', inp );
                document.getElementById("mesText").value = '';
                return false;
            }
            function loadAll() {
                document.getElementById("mes-container").innerHTML = '';
                socket.emit('loadAll');
            }
            window.onload = function () {
                let pass = prompt("Пароль: ");
                socket.emit('login', pass);
                socket.on('new message show', function (msg) {
                    let div = document.createElement('div');
                    div.innerHTML = msg;
                    document.getElementById('mes-container').appendChild(div);
                    scroll();
                    if(msg == false)
                      while(document.body.childNodes.length != 0) 
                        document.body.removeChild(document.body.childNodes[0])
                });
                scroll()
            }
            function scroll() {
                let div = document.getElementById('mes-container');
                div.scrollTop = div.scrollHeight - div.clientHeight;
            }
            window.onresize = function() { scroll(); };
